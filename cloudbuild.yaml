steps:
# Step 0: build
- name: 'gcr.io/cloud-builders/docker'
  args: [
    'build',
    '-t','asia-east1-docker.pkg.dev/$PROJECT_ID/cloud-run-source-deploy/ticketsearch:$SHORT_SHA',
    '.'
  ]

# Step 1: push
- name: 'gcr.io/cloud-builders/docker'
  args: [
    'push',
    'asia-east1-docker.pkg.dev/$PROJECT_ID/cloud-run-source-deploy/ticketsearch:$SHORT_SHA'
  ]

# Step 2: deploy
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: gcloud
  args: [
    'run','deploy','ticketsearch',
    '--region','asia-east1',
    '--image','asia-east1-docker.pkg.dev/$PROJECT_ID/cloud-run-source-deploy/ticketsearch:$SHORT_SHA',
    '--allow-unauthenticated',
    '--set-secrets','LINE_CHANNEL_ACCESS_TOKEN=line-channel-token:latest,LINE_CHANNEL_SECRET=line-channel-secret:latest,CRON_KEY=cron-key:latest',
    '--update-env-vars','DEFAULT_INTERVAL=15',
    '--timeout','300'
  ]

options:
  logging: CLOUD_LOGGING_ONLY

images:
<<<<<<< HEAD
- 'asia-east1-docker.pkg.dev/$PROJECT_ID/cloud-run-source-deploy/ticketsearch:$SHORT_SHA'
=======
- 'asia-east1-docker.pkg.dev/$PROJECT_ID/cloud-run-source-deploy/ticketsearch:$SHORT_SHA'
>>>>>>> 3bf2749 (Add Dockerfile/cloudbuild and requirements)
